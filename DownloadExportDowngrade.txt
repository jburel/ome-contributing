Download/Export/Downgrade
==========================




**To test in**: Web, Insight

**Purpose of the test** is to check the Download, Export and Downgrade features and the downloaded files - depending on whether archived image was created at import and whether this was an FS import or not.

Note: if several images have to be downloaded a zip will be created (Web and Insight) - this might take couple of seconds with no warning.

#.  Download non-image files (both FS and non-FS):

    - Import an image with a companion file e.g. ``data_repo/test_images_good/dv/CFPNEAT01_R3D.dv`` (or see column "Extra information" in [:download:`here </downloads/ImportTestingSetTable.pdf>`])

    - Select the image, go to the right-hand panel, Acquisition tab, Companion files, and (Insight only) left-click on icon to the right of the filename to see a menu.

    - |C| that you can see Info [:ref:`DownloadEDScreen001`][:ref:`DownloadEDScreen002`]and View the file 

    - Download the Companion file [:ref:`DownloadEDScreen003`][:ref:`DownloadEDScreen004`] - open downloaded file in text editor,
    - |C| that the size is not zero.[:ref:`DownloadEDScreen005`]

    - Download the metadata file created by OMERO i.e. ``original_metadata.txt`` [:download:`original_metadata.txt </downloads/Export_Downgrade_original_metadata.txt>`] (Acquisition tab) [:ref:`DownloadEDScreen006`][:ref:`DownloadEDScreen007`].

    - Download the metadata file using the menu item under the icon above right-hand pane (Insight only) [:ref:`DownloadEDScreen007b`]

    - |C| the downloaded file [:download:`008 </downloads/Export_Downgrade_008.txt>`].


#.  non-FS-Download/Export images: 
 

    - Import an image - tick the "Archive" option after putting it into the Queue [:ref:`DownloadEDScreen009`] (Insight only)

    - When the import is finished, select the image

    - Go to the right-hand panel General tab,

         - |C| that you see the image is shown as ``Archived`` in Insight [:ref:`DownloadEDScreen010a`]
         - in Insight, press the Saving icon [2nd form right] and choose Download.[:ref:`DownloadEDScreen010b`]
         - in Web click on the arrow in General tab [:ref:`DownloadEDScreen011`]
         - |C| that the image has correctly been downloaded [:ref:`DownloadEDScreen012`]
         - Re-import the image.(import in Insight, but check in Web as well)
         - |C| Compare the image originally imported and the re-imported image (check also the metadata) [:ref:`DownloadEDScreen013`]

    - Import an image composed of several files, e.g. `test_images_good/lei/050118.lei` - tick the "Archive" option after putting it into the Queue [:ref:`DownloadEDScreen009`] (Insight only)

         - Select the download option on the right-hand side
         - Download the image - a zip will be created [:ref:`DownloadEDScreen013b`]
         - |C| that the image has been downloaded correctly [:ref:`DownloadEDScreen013c`]
         - Re-import the image.(import in Insight, but check in Web as well)
         - Compare the image originally imported and the re-imported image (check also the metadata).

    - Now Select an image which had the "Archive" option off at import. If not sure, re-import an image with the "Archive" option off.
         - |C| that you see the image is not shown as ``Archived`` in Insight [:ref:`DownloadEDScreen013d`]
         - |C| that the Download option is not available neither in Insight (greyed out) [:ref:`DownloadEDScreen013e`] nor Web (menu item missing) [:ref:`DownloadEDScreen013f`]


#.  FS-Download/Export images (perform on FS server with FS-data-only database)

    - FS-Single image

         - Import an image
         - Select the download option on the right-hand side [:ref:`DownloadEDScreen010b`, :ref:`FSDownloadEDScreen011`]
         - Download the image
         - |C| that the image has been correctly downloaded [:ref:`DownloadEDScreen012`]
         - Re-import the image.(import in Insight, but check in Web as well)
         - Compare the image originally imported and the re-imported image (check also the metadata) [:ref:`DownloadEDScreen013`].

    - FS-multi-image - repeat the "FS-Single image" step importing a multi-image file (e.g. `test_images_good/lei/050118.lei`).



#.  Mixed FS & non-FS Download/Export images (this is to be performed on FS server with a database consisting of non-FS as well as FS images)

         - Choosing images imported using non-FS and skipping importing, go through the "non-FS-Download/Export images:" step
         - Go through the "FS-Download/Export images" step



#.  Downgrade:

    - Select an image and go to the right-hand panel.
    - Export the image as JPEG (Web & Insight) [:ref:`DownloadEDScreen016`, :ref:`DownloadEDScreen017`], PNG (Insight only), TIFF (Insight only) 

      - |C| the result

    - Export the image as OME-TIFF [:ref:`DownloadEDScreen017b`, :ref:`DownloadEDScreen017c`]
      - for Web, just export and check the file - for Insight, see below
      - Export using the current schema:[:ref:`DownloadEDScreen018`] (Insight only)

        - |C| the exported file,
        - |C| Open the file
        - |C| the XML section the schema version should indicate the latest version e.g. 2012..[:ref:`DownloadEDScreen019`].-Do it from command line [tiffinfo command from libtiff library - download tiffinfo using Homebrew][:ref:`DownloadEDScreen020`]

      - Export using an older schema:(Insight only)

        - |C| the exported file
        - |C| Open the file
        - |C| the XML section, the schema version should match the selected schema.[:ref:`DownloadEDScreen021`] - Check from command line using tiffinfo
      - Re-Import the exported files

	.. _DownloadEDScreen001:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/001.png
	   :align: center

	   DownloadEDScreen001: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen002:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/002.png
	   :align: center

	   DownloadEDScreen002:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen003:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/003.png
	   :align: center
	   :width: 100%

	   DownloadEDScreen003


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen004:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/004.png
	   :align: center

	   DownloadEDScreen004


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen005:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/005.png
	   :align: center

	   DownloadEDScreen005


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen006:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/006.png
	   :align: center

	   DownloadEDScreen006: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen007:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/007.png
	   :align: center

	   DownloadEDScreen007:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen007b:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/007b.png
	   :align: center

	   DownloadEDScreen007b:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen009:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/009.png
	   :align: center

	   DownloadEDScreen009: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen010:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/010.png
	   :align: center

	   DownloadEDScreen010:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen010a:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/010a.png
	   :align: center

	   DownloadEDScreen010a:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen010b:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/010b.png
	   :align: center

	   DownloadEDScreen010b:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen011:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/011.png
	   :align: center

	   DownloadEDScreen011


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _FSDownloadEDScreen011:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/FS011.png
	   :align: center

	   FSDownloadEDScreen011


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen012:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/012.png
	   :align: center

	   DownloadEDScreen012


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen013:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/013.png
	   :align: center

	   DownloadEDScreen013


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen013b:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/013b.png
	   :align: center

	   DownloadEDScreen013b


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen013c:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/013c.png
	   :align: center

	   DownloadEDScreen013c


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen013d:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/013d.png
	   :align: center

	   DownloadEDScreen013d


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen013e:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/013e.png
	   :align: center

	   DownloadEDScreen013e


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|	
	|


	.. _DownloadEDScreen013f:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/013f.png
	   :align: center

	   DownloadEDScreen013f


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen014:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/014.png
	   :align: center

	   DownloadEDScreen014: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen015:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/015.png
	   :align: center

	   DownloadEDScreen015:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen016:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/016.png
	   :align: center

	   DownloadEDScreen016


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen017:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/017.png
	   :align: center

	   DownloadEDScreen017: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen017b:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/017b.png
	   :align: center

	   DownloadEDScreen017b: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen017c:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/017c.png
	   :align: center

	   DownloadEDScreen017c: 


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|

	.. _DownloadEDScreen018:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/018.png
	   :align: center

	   DownloadEDScreen018:


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen019:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/019.png
	   :align: center
	   :width: 100%

	   DownloadEDScreen019


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen020:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/020.png
	   :align: center

	   DownloadEDScreen020


	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|


	.. _DownloadEDScreen021:
	.. figure:: /images/testing_scenarios/DownloadExportDowngrade/021.png
	   :align: center
	   :width: 110%

	   DownloadEDScreen021
	
	
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|
	|

