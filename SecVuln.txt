Security Vulnerability
======================


**To test in**: CLI

**Purpose of the test** is to check the security vulnerability

#. Setup a 4.4.11/5.0.4 server

#. Download the 4.4.11/5.0.4 CLI or use the one with the server

#. Create a group for testing the user creation::

     $ bin/omero group add secvuln_test

#. Create a user via the CLI with interactive password prompt::

      $ bin/omero user add secvuln_empty secvuln_empty secvuln_empty secvuln_test

   - Enter `ome` when prompted for the password.
   - |C| ``$ bin/omero login -C -u secvuln_empty -w anypassword`` creates a session

#. Create a user via the CLI with a full unicode password::

      $ bin/omero user add secvuln_unicode secvuln_unicode secvuln_unicode secvuln_test -P ążćę

   - |C| ``$ bin/omero login -C -u secvuln_unicode`` creates a session after entering `żćąę` in the interactive password prompt
   - |C| ``$ bin/omero login -C -u secvuln_unicode -w żćąę`` creates a session
   - |C| ``$ bin/omero login -C -u secvuln_unicode -w ążćę`` creates a session
   - |C| ``$ bin/omero login -C g-u secvuln_unicode -w '????'`` creates a session
   - |C| ``$ bin/omero login -C g-u secvuln_unicode -w '??'`` fails to create a session
   - |C| ``$ bin/omero login -C g-u secvuln_unicode -w '?'`` fails to create a session

#. Upgrade the server to 4.4.12/5.0.5

#. Download the 4.4.12/5.0.5 CLI or use the one with the server. Use this new
   CLI for the following tests.

#. Create a user via the CLI with interactive password prompt::

      $ bin/omero user add secvuln_empty_fix secvuln_empty_fix secvuln_empty_fix secvuln_test

   - Enter `ome` when prompted for the password.
   - |C| ``$ bin/omero login -C -u secvuln_empty_fix -w anypassword`` fails to create a session
   - |C| ``$ bin/omero login -C -u secvuln_empty_fix -w ome`` creates a session

#. Create a user via the CLI with a full unicode password::

      $ bin/omero user add secvuln_unicode_fix secvuln_unicode_fix secvuln_unicode_fix secvuln_test -P ążćę

   - |C| ``$ bin/omero login -C -u secvuln_unicode -w ążćę`` creates a session
   - |C| ``$ bin/omero login -C -u secvuln_unicode_fix`` fails to create a session  after entering `żćąę` in the interactive password prompt
   - |C| ``$ bin/omero login -C -u secvuln_unicode_fix -w żćąę`` fails to create a session
   - |C| ``$ bin/omero login -C -u secvuln_unicode_fix -w ????`` fails to create a session
   - |C| ``$ bin/omero login -C -u secvuln_unicode_fix -w ??`` fails to create a session
   - |C| ``$ bin/omero login -C -u secvuln_unicode_fix -w ?`` fails to create a session

#. Run the SQL script allowing to disable users with empty password

   - |C| ``$ bin/omero login -C -u secvuln_empty -w anypassword`` fails to create a session
   - |C| ``$ bin/omero login -C -u secvuln_empty -w ome`` fails to create a session
